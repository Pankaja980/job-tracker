<div class="job-tracker-container">
  <!-- ðŸ”¹ Page Title -->
  <div class="sidebar">
  <h2 class="tracker-title">Job Tracker</h2>
  <!--   -->
  <!-- ðŸ”¹ Job Category Selector (Filter by Level) -->
  <div class="controls">
  <app-job-category-selector 
    (selectedCategoryChange)="onLevelChange($event)">
  </app-job-category-selector>
<br>
  <!-- ðŸ”¹ Add Job Button -->
  <div class="job-actions">
  <button pButton type="button"  icon="pi pi-plus" class="add-job-btn" (click)="addJob()">+ Add Job</button>
  <!-- ðŸ”¹ Job Title Search -->
  <div class="search-container" style="display: flex; align-items: center; margin-left: auto;">
    <input type="text" pInputText placeholder="Search Job Titles" (input)="onSearch($event)" class="search-input" style="margin-right: 8px;" />
    <button class="search-btn" pButton type="button" icon="pi pi-search" style="margin-left: 8px;"></button>
  </div>
  </div>
</div>
</div>
  <!-- ðŸ”¹ Jobs Table -->
  <div class="job-list-container">
  <p-table #dt 
    [value]="(filteredJobs$ | async) || []" 
    [paginator]="true" 
    [rows]="5" 
    responsiveLayout="scroll" 
    [stripedRows]="true" 
    class="job-table"
  >
    
    <ng-template pTemplate="header">
      <tr>
        <th  style="width: 50%">Job Title</th>
        <th style="width: 20%;">Company</th>
        <th style="width: 10%;">Level</th>
        <th style="width: 10%;">Status</th>
        <th style="width: 10%;">Actions</th>
      </tr>
    </ng-template>
    
    <ng-template pTemplate="body" let-job>
      <tr>
        <td>{{ job.name }}</td>
        <td>{{ job.company.name }}</td>
        <td>{{ getJobLevels(job) }}</td>
        <td>
          <!-- <p-dropdown 
            [options]="jobStatusOptions"
            [(ngModel)]="job.status"
            (onChange)="onStatusChange(job, $event.value)">
          </p-dropdown> -->
          <!-- If editing or adding, show the dropdown -->
          <p-dropdown 
          *ngIf="isEditMode && selectedJob?.id === job.id" 
          formControlName="jobStatus" 
          [options]="jobStatusOptions" 
          optionLabel="label"
          (ngModelChange)="onStatusChange(job, $event)">
          </p-dropdown>

<!-- Otherwise, show status as plain text -->
          <span *ngIf="!isEditMode || selectedJob?.id !== job.id">
          {{ job.status ||'Applied'}}
          </span>

        </td>
        <td>
          <button pButton icon="pi pi-pencil" class="edit-btn" (click)="editJob(job)"> Edit </button><br>
          <button pButton icon="pi pi-trash" class="delete-btn" (click)="confirmDelete(job)">Delete</button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
  <!-- ðŸ”¹ Add/Edit Job Dialog -->
  <p-dialog [(visible)]="displayDialog" [modal]="true" header="{{ selectedJob ? 'Edit Job' : 'Add Job' }}">
    <app-job-form [job]="selectedJob" (saveJob)="onJobSave($event)" (cancel)="onCancel()"></app-job-form>
  </p-dialog>
  
  <!-- ðŸ”¹ Confirm Delete Dialog -->
  <p-confirmDialog header="Delete Job" 
  icon="pi pi-exclamation-triangle" 
  acceptLabel="Delete" 
  rejectLabel="Cancel"
  [style]="{ width: '400px' }"></p-confirmDialog>

  <!-- ðŸ”¹ Toast Messages -->
  <p-toast></p-toast>

  <!-- ðŸ”¹ Job Levels Chart (At the Bottom) -->
  <div class="chart-container">
    <p-chart type="bar" [data]="levelChartData" [options]="levelChartOptions"></p-chart>
  </div>
</div>
